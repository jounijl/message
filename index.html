<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
    <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Message by jounijl</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/jounijl/message">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Message</h1>
            <h2></h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/jounijl/message/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/jounijl/message/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h3>Stream reader and writer</h3>

<p>Librarys main purpose are six functions: </p>

<pre><code>int  cb_set_cursor(CBFILE **cbs, char **name, int *namelength);

int  cb_remove_name_from_stream(CBFILE **cbs);
</code></pre>

<p>cb_set_cursor finds a name from streams name-value pairs and sets the cursor to the end of the name. While the function is reading the stream it places it's data in a buffer and saves every name it finds in it's memory structure. It finds every name from buffer according to it's data structures information of offsets of the names when reading again. </p>

<p>The buffer does not move with the stream. When the end of buffer is reached, name-value pairs must be in the order they are used. It is best if name-value pairs are in the same order in the input as is the order of using them. If buffer end is reached, CBSTREAM is returned. If this happens, the last names value may be at the border of buffer. In these cases the name must be removed from data structure with cb_remove_name_from_stream. </p>

<p>If you get CBSTREAM when reading a character, the block read has reached the buffer boundary and the character is not in the buffer anymore. You may have to do with it immediately what was needed to do because it's allready in stream and it's not automatically saved anymore. It's better to read the values just before they are needed. </p>

<pre><code>int  cb_get_chr(CBFILE **cbs, unsigned long int *chr, int *bytecount, int *storedbytes);
int  cb_put_chr(CBFILE **cbs, unsigned long int *chr, int *bytecount, int *storedbytes);
</code></pre>

<p>Library reads UCS 32-bit word length characters from UTF-8 transfer data. It reads and writes to or from one byte, two byte or UTF-8 encoded transfer data. </p>

<h4>Data structures</h4>

<p>Primary data structures in CBFILE are: </p>

<pre><code>typedef struct CBFILE{
        int    fd;      // Stream file descriptor
        cbuf  *cb;      // Data in valuepairs (preferably in application order)
        cblk  *blk;     // Input read or output write -block 
...
} CBFILE;
</code></pre>

<ul>
<li>file descriptor to read or write, fd</li>
<li>block to read or write, cblk</li>
<li>buffer to save read stream, cbuf</li>
</ul><p>Primary data structures in structure to save the names are: </p>

<pre><code>typedef struct cb_name{
...
        char  *namebuf; // name
        int   namelen; // name length
        int   offset; // offset from the beginning of data
        void  *next; // Last is NULL
...
} cb_name;
</code></pre>

<p>It is a linked list. This is only to understand what happens in the library. Only above functions and CBFILE allocation functions are meant to be used:</p>

<pre><code>int  cb_allocate_cbfile(CBFILE **buf, int fd, int bufsize, int blocksize);
int  cb_free_cbfile(CBFILE **buf);
</code></pre>

<p>Remember to free CBFILE:s memory after using.</p>

<h4>Data read</h4>

<p>Data written and read are valuepairs. Value name may contain comments (between # and \n). Flow control characters are:</p>

<pre><code>'=' Separates data from it's name
'&amp;' Separates pairs
'\' Escapes next flow control character
'#' Comment to next newline
</code></pre>

<p>Characters can be set to another. Tabs, new lines and white spaces are removed between pairs. Tabs and white spaces in names are removed before comparing them.</p>

<p>For example:</p>

<pre><code>name_of_value=data_of_value&amp;another_name=another_data&amp;   third_name=third_data&amp;
      fourthname =fourth_data&amp; # Comment
name of last pair =last_p\&amp;air\\s_data&amp; 
</code></pre>

<p>Last pairs value contains two bypassed control characters '&amp;' and '\'.</p>

<p>Example of nesting consecutive streams:</p>

<pre><code>data_field {
  name1 = value1;
  name2 = value2; # Comment 
}
</code></pre>

<p>Library can be used for example in reading or writing configuration files, reading a POST responce from browser, parsing email header files or in interprocess messaging.</p>

<h3>Issues and bug tracking</h3>

<p>Information about issues and bugs are welcomed. Very welcomed is information about using the library. Library was tested with some tests before writing this. It appears useful and bugs can be fixed. Testing stub is still incomplited.</p>

<h3>Authors and Contributors</h3>

<p>Jouni L. email: jnl (cat and tail) iki (dot) fi.</p>

<p><a href="http://jounijl.github.com/message"></a><a href="http://jounijl.github.com/message">http://jounijl.github.com/message</a></p>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/jounijl">jounijl</a> can be found on <a href="https://github.com/jounijl/message">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-39364465-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
